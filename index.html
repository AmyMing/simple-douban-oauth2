<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Simple-douban-oauth2 : A simple php douban oauth2 client" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/highlight/99_solarized_dark.css" />
    <script src="javascripts/highlight.pack.js"></script>
    <title>Simple-douban-oauth2</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/zither/simple-douban-oauth2">View on GitHub</a>

          <h1 id="project_title">Simple-douban-oauth2</h1>
          <h2 id="project_tagline">A simple douban PHP oauth2 client</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/zither/simple-douban-oauth2/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/zither/simple-douban-oauth2/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>关于</h3>
        <p>Simple douban oauth2是一个非常简洁的豆瓣PHP Oauth2 SDK，为小型PHP网站提供了简单的豆瓣Oauth2认证及豆瓣各类Api调用接口。目前基础Api已经全部测试完毕，接下来会逐步完善PHP客户端文档。</p>

        <h3>状态</h3>
        <p>目前支持的豆瓣Api如下：</p>
        <pre><code>
    - 图书 Book
    - 电影 Movie 
    - 音乐 Music 
    - 同城 Event 
    - 广播 Miniblog 
    - 用户 User
    - 豆邮 Doumail 
    - 日记 Note 
    - 相册 Photo
    - 线上活动 Online
    - 论坛 discussion
    - 回复 comment
        </code></pre>

        <h3>豆瓣api权限列表</h3>
        <p>豆瓣暂时只开放了基础api，所有可申请的权限组如下</p>
        <pre><code>豆瓣公共
douban_basic_common：豆瓣公共api
豆瓣电影
movie_basic_r：获取你的电影信息、评论、标签等
movie_basic_w：发布、修改、删除你的电影评论，添加、更新、删除你的收藏信息
豆瓣社区
community_basic_note：豆瓣社区日记功能
community_basic_user：豆瓣社区用户信息
community_basic_photo：豆瓣社区相册基本功能
community_basic_online：获取线上活动信息，参加者，论坛；获取热门线上活动列表
豆瓣读书
book_basic_r：读书基本读功能，包括获取书籍信息，评论等
book_basic_w：读书基本写功能，包括发布、修改、删除读书评论
豆瓣音乐
music_basic_r：豆瓣音乐基本读功能，包括获取音乐信息，评论等
music_basic_w：豆瓣音乐基本写功能，包括发布、修改、删除评论
music_artist_r：音乐人相关API
豆瓣广播
shuo_basic_r：获得你的个人信息，好友关系和我说
shuo_basic_w：修改你的个人信息、好友关系; 发布或修改你的广播
豆瓣同城
event_basic_r：豆瓣同城基本读功能
event_basic_w：豆瓣同城基本写功能
        </code></pre>


        <h3>用法</h3>
        <p>这里以使用Simple douban oauth2来发送图片广播作为的例子。</p>

        <pre><code>// 载入豆瓣Oauth类
require '../src/DoubanOauth.php';

/* ------------实例化Oauth2--------------- */

// 豆瓣应用public key
$clientId = '037c0301d3b81d570a7409057b285805';
// 豆瓣应用secret key
$secret = 'c2c9c36981ef49c6';
// 用户授权后的回调链接
$callback = 'http://localhost/example/example.php';
// 设置应用需要的权限，Oauth类默认设置为douban_basic_common
// 我们要发送豆瓣广播，就必须申请shuo_basic_w权限
$scope ='douban_basic_common,shuo_basic_r,shuo_basic_w';
// 生成一个豆瓣Oauth类实例
$douban = new DoubanOauth($clientId, $secret, $callback, $scope);


/* ------------请求用户授权--------------- */

// 如果没有authorizeCode，跳转到用户授权页面
if ( ! isset($_GET['code'])) {
    $douban->requestAuthorizeCode();
    exit;
}
// 设置authorizeCode
$douban->setAuthorizeCode($_GET['code']);
// 通过authorizeCode获取accessToken，至此完成用户授权
$douban->requestAccessToken();


/* ------------豆瓣API请求示例--------------- */

// 使用POST方法发送一条带图片的豆瓣广播
// 豆瓣API小组里很多朋友都卡在了发送图片广播上，那是因为没有正确设置Content-Type。
// 在PHP中通过curl上传图片需使用“@/home/chou/images/123.png;type=image/png”格式。
// 必须在图片绝对路径后指定正确的图片类型，如果没有就会返回“不支持的图片类型错误”。
// 那是因为没有指定图片类型时，上传的文件类型默认为“application/octet-stream”。
$data = array(
            'source' => $clientId, 
            'text' =>'继续修改，继续测试。', 
            'image' => '@/home/chou/downloads/123.jpg;type=image/jpeg'
            );
// 发表广播需要用到豆瓣广播API，注册一个豆瓣广播API实例
$miniblog = $douban->api('Miniblog.statuses.POST');
// 使用豆瓣Oauth类向我说API发送请求，并获取返回结果
// 使用需授权API时请把makeRequest第三个参数设置为true
$result = $douban->makeRequest($miniblog, $data, true);

// 使用GET方法获取制定书籍信息
$book = $douban->api('Book.info.GET', array('id' => '20458897'));
// GET请求不需要设置POSTDATA，无需授权的API也不需要发送accessToken
$bookInfo = $douban->makeRequest($book);

var_dump($result);
var_dump($bookInfo);
       </code></pre>

        <p>Simple douban oauth2的所有API类都保存在<strong>api</strong>文件夹中，你可以非常方便的按照需求修改各个接口。</p>

        <p>一个简单的豆瓣广播Api类作为示例：</p>

        <pre><code>class DoubanMiniblog extends DoubanBase {

        // 初始化clientId，在uri后面添加apikey可以拥有更宽裕的请求次数
        public function __construct($clientId)
        {
            $this->clientId = $clientId;
        }

        /**
         * @brief 用户对豆瓣广播相关操作
         *
         * @param string $requestType GET,POST,DELETE
         * @param array $params
         *
         * @return object
         */
        public function statuses($requestType, $params)
        {
            $this->type = $requestType;
            switch ($this->type) {
                case 'GET':
                case 'DELETE':
                    $this->uri = '/shuo/v2/statuses/'.$params['id'];
                    break;
                case 'POST':
                    $this->uri = '/shuo/v2/statuses/';
                    break;
            }
            return $this;
        }

        /**
         * @brief 获取用户关注者列表。
         *
         * @param string $requestType GET
         * @param array $params
         *
         * @return object
         */
        public function followers($requestType, $params)
        {
            $this->type = $requestType;
            $this->uri = '/shuo/v2/users/'.$params['id'].'/followers';
            return $this;
        }
    }
        </code></pre>

        <h3>接口列表</h3>
        <p>豆瓣用户</p>
        <pre><code>User.info.GET  获取用户个人信息  参数 'id' 
User.me.GET  获取当前登录用户信息  需授权
User.search.GET  搜索用户  参数 'q' 'start' 'count'</code></pre>
        <p>豆瓣图书</p>
        <pre><code>Book.info.GET  获取书籍信息  参数 'id' 
Book.isbn.GET  通过isbn获取书籍信息  参数 'isbn'
Book.search.GET  搜索图书  参数 'q' 'tag' 'start' 'count'
Book.bookTags.GET  获取图书中最多标签  参数 'id'
Book.userTags.GET  获取用户对图书的所有标签  参数 'name'
Book.collections.GET  获取用户的所有图书收藏信息  参数 'name'
Book.collection.GET(POST|PUT|DELETE)  用户对某本图书的收藏信息  参数 'id'
Book.userAnnotations.GET  用户的所有笔记  参数 'name'
Book.bookAnnotations.GET  某本图书的所有笔记  参数 'id'
Book.annotation.GET(POST|PUT|DELETE) 操作某本书的笔记  参数 'id'
Book.review.POST(PUT|DELETE)  用户对书评相关操作  参数 'id'</code></pre>
         <p>豆瓣电影</p>
        <pre><code>Movie.info.GET  获取电影信息  参数 'id' 
Movie.imdb.GET  通过imdb获取电影信息  参数 'imdb'
Movie.search.GET  搜索电影  参数 'q'  'tag' 'start' 'count'
Movie.movieTages.GET  获取某电影最多标签  参数 'id'
Movie.userTags.GET  获取用户对电影的所有标签  参数 'id'
Movie.review.POST(PUT|DELETE)  电影评论相关操作  参数 'id'</code></pre>          
        <p>豆瓣音乐</p>
        <pre><code>Music.info.GET  获取音乐信息  参数 'id' 
Music.search.GET  搜索音乐  参数 'q'  'tag' 'start' 'count'
Music.musicTages.GET  获取某音乐标记最多的标签  参数 'id'
Music.userTags.GET  获取用户对音乐的所有标签  参数 'id'
Music.review.POST(PUT|DELETE)  音乐评论相关操作  参数 'id'</code></pre>
        <p>豆瓣同城</p>
        <pre><code>Event.info.GET  获取同城活动信息  参数 'id' 
Event.wishers.GET  获取对活动感兴趣的用户  参数 'id'
Event.userCreated.GET  获取用户创建的活动  参数 'id'
Event.userParticipated.GET  获取用户参与的活动  参数 'id'
Event.userWished.GET  获取用户感兴趣的活动  参数 'id'
Event.eventList.GET  获取同城活动列表  参数 'loc' 'day_type' 'type'
Event.loc.GET  获取城市信息  参数 'id'
Event.locList.GET  获取城市列表
Event.participants.POST(DELETE)  参加或者退出同城活动  参数 'id'
Event.wish.POST(DELETE)  关注或者取消关注某活动  参数 'id'  </code></pre>
        <p>豆瓣广播</p>
        <pre><code>Miniblog.statuses.GET(POST|DELETE)  用户获取（发表|删除）豆瓣广播  参数 'id' 
Miniblog.commentsList.GET  获取广播的回复列表  参数 'id'
Miniblog.comment.GET(POST|DELETE)  对广播回复相关操作  参数 'id'
Miniblog.reshare.GET(POST)  获取转播信息或转播广播  参数 'id'
Miniblog.like.GET(POST|DELETE)  赞相关操作  参数 'id'
Miniblog.following.GET  获取用户关注列表  参数 'id'
Miniblog.followers.GET  获取用户关注者列表  参数 'id'
Miniblog.followInCommon.GET  获取共同关注列表  参数 'id'
Miniblog.suggestions.GET  获取关注的人关注了该用户的列表  参数 'id'
Miniblog.block.POST  将制定用户加入黑名单  参数 'id'
Miniblog.follow.POST  关注某用户
Miniblog.unfollow.POST  取消关注某用户
Miniblog.show.GET  获取两个用户的关系  参数 'source' 'source_id' 'target_id'
Miniblog.homeTimeline.GET  获取友邻广播
Miniblog.userTimeline.GET  获取用户发表的广播列表  参数 'user'</code></pre>
        <p>豆邮</p>
        <pre><code>Doumail.mail.GET(POST|PUT|DELETE)  对单封邮件的相关操作  参数 'id'
Doumail.inbox.GET  获取用户收件箱
Doumail.outbox.GET  获取用户发件箱
Doumail.unread.GET  获取用户未读豆邮
Doumail.multiRead.PUT  批量标记已读
Doumail.multiDelete.POST  批量删除豆邮</code></pre>
        <p>豆瓣日记</p>
        <pre><code>Note.note.GET(POST|PUT|DELETE)  豆瓣日记CRUD操作  参数 'id'
Note.like.POST(DELETE)  喜欢或者取消喜欢某日记  参数 'id'
Note.image.POST  上传图片到日记  参数 'id'
Note.commentsList.GET  获取回复列表  参数 'id'
Note.comment.GET(POST|DELETE)  日记评论相关操作 参数 'noteId' 'commentId'</code></pre>
        <p>豆瓣相册</p>
        <pre><code>Photo.album.GET(POST|PUT|DELETE)  豆瓣相册CRUD操作  参数 'id'
Photo.photosList.GET  获取相册相片列表  参数 'id'
Photo.albumLike.POST(DELETE)  喜欢或者取消喜欢  参数 'id'
Photo.userAlbumList.GET  获取用户创建的相册列表  参数 'id'
Photo.userLiked.GET  获取用户喜欢的相册列表  参数 'id'
Photo.photo.GET(POST|PUT|DELETE)  相片CRUD操作  参数 'id'
Photo.photoLike.POST(DELETE)  喜欢或取消喜欢某张照片  参数 'id'</code></pre>
        <p>豆瓣线上活动</p>
        <pre><code>Online.discussions.GET(POST)  获取线上活动论坛列表  参数 'id'
Online.onlinesList.GET  获取线上活动列表  参数 'cate'
Online.online.GET(POST|PUT|DELETE)  线上活动CRUD操作  参数 'id'
Online.participants.GET  获取线上活动成员列表  参数 'id'
Online.participants.POST(DELETE)  参加或退出线上活动  参数 'id'
Online.like.POST(DELETE)  喜欢或者不喜欢某线上活动  参数 'id'
Online.photos.GET  线上活动图片列表  参数 'id'
Online.userParticipated.GET  获取用户参加的线上活动列表  参数 'id'
Online.userCreated.GET  获取用户创建的线上活动  参数 'id'</code></pre>
        <p>论坛相关</p>
        <pre><code>Discussion.discussion.GET(POST|PUT|DELETE)  讨论CRUD操作  参数 'target' 'targetId' 'commentId'
Comment.commentsList.GET  获取相内容的评论列表  参数 'target' 'id'</code></pre>
        <p>回复相关</p>
        <pre><code>Comment.comment.GET(POST|PUT|DELETE)  评论CRUD操作  参数 'target' 'id'
Discussion.discussionsList.GET  获取相内容的评论列表  参数 'target' 'id'</code></pre>

        <h3>更新</h3>
        <p>2012.12.17：添加接口相关文档。</p>
        <p>如果你在使用过程中遇到问题，请联系ilorn.mc at gmail.com。</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Simple-douban-oauth2 maintained by <a href="https://github.com/zither">zither</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
