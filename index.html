<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Simple-douban-oauth2 : A simple php douban oauth2 client" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/highlight/99_solarized_dark.css" />
    <script src="javascripts/highlight.pack.js"></script>
    <title>Simple-douban-oauth2</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/zither/simple-douban-oauth2">View on GitHub</a>

          <h1 id="project_title">Simple-douban-oauth2</h1>
          <h2 id="project_tagline">A simple php douban oauth2 client</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/zither/simple-douban-oauth2/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/zither/simple-douban-oauth2/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h3>About</h3>
        <p>Simple douban oauth2是一个非常简洁的豆瓣PHP Oauth2 SDK，为小型PHP网站提供了简单的豆瓣Oauth2认证及豆瓣各类Api调用接口。目前还有很多api接口没有经过测试，我会尽快完成测试，并逐步完善PHP客户端文档。</p>

        <h3>Status</h3>
        <p>目前支持的豆瓣Api如下：</p>
        <pre><code>
        - 图书 Book
        - 电影 Movie 
        - 音乐 Music 
        - 同城 Event 
        - 广播 Miniblog 
        - 用户 User
        - 豆邮 Doumail 
        - 日记 Note 
        - 相册 Photo
        - 线上活动 Online
        - 论坛 discussion
        - 回复 comment
        </code></pre>

        <h3>Usage</h3>
        <p>这里以使用Simple douban oauth2来发送图片广播作为的例子。</p>

        <pre><code>// 载入豆瓣Oauth类
require '../src/DoubanOauth.php';

/* ------------实例化Oauth2--------------- */

// 豆瓣应用public key
$clientId = '037c0301d3b81d570a7409057b285805';
// 豆瓣应用secret key
$secret = 'c2c9c36981ef49c6';
// 用户授权后的回调链接
$callback = 'http://localhost/example.php';
// 设置应用需要的权限，Oauth类默认设置为douban_basic_common
// 我们要发送豆瓣广播，就必须申请shuo_basic_w权限
$scope ='douban_basic_common,shuo_basic_r,shuo_basic_w,community_advanced_doumail_r';
// 生成一个豆瓣Oauth类实例
$douban = new DoubanOauth($clientId, $secret, $callback, $scope);


/* ------------请求用户授权--------------- */

// 如果没有authorizeCode，跳转到用户授权页面
if ( ! isset($_GET['code'])) {
    $douban->requestAuthorizeCode();
    exit;
}
// 设置authorizeCode
$douban->setAuthorizeCode($_GET['code']);
// 通过authorizeCode获取accessToken，至此完成用户授权
$douban->requestAccessToken();


/* ------------发送图片广播--------------- */

// 通过豆瓣API发送一条带图片的豆瓣广播
// 豆瓣API小组里很多朋友都卡在了发送图片广播上，那是因为没有正确设置Content-Type。
// 在PHP中通过curl上传图片需使用“@/home/chou/images/123.png;type=image/png”格式。
// 必须在图片绝对路径后指定正确的图片类型，如果没有就会返回“不支持的图片类型错误”。
// 那是因为没有指定图片类型时，上传的文件类型默认为“application/octet-stream”。
$data = array(
            'source' => $clientId, 
            'text' =>'继续修改，继续测试。', 
            'image' => '@/home/chou/downloads/123.jpg;type=image/jpeg'
            );
// 发表广播需要用到豆瓣广播API，注册一个豆瓣广播API实例
$miniblog = $douban->api('Miniblog.statuses.POST');
// 使用豆瓣Oauth类向我说API发送请求，并获取返回结果
$result = $douban->makeRequest($miniblog, $data, true);

var_dump($result);
       </code></pre>

        <p>Simple douban oauth2的所有API类都保存在<strong>api</strong>文件夹中，你可以非常方便的按照需求修改各个接口。</p>

        <p>一个简单的豆瓣图书Api类作为示例：</p>

        <pre><code>class DoubanMiniblog extends DoubanBase {

        // 初始化clientId，在uri后面添加apikey可以拥有更宽裕的请求次数
        public function __construct($clientId)
        {
            $this->clientId = $clientId;
        }

        /**
         * @brief 用户对豆瓣广播相关操作
         *
         * @param string $requestType GET,POST,DELETE
         * @param array $params
         *
         * @return object
         */
        public function statuses($requestType, $params)
        {
            $this->type = $requestType;
            switch ($this->type) {
                case 'GET':
                case 'DELETE':
                    $this->uri = '/shuo/v2/statuses/'.$params['id'];
                    break;
                case 'POST':
                    $this->uri = '/shuo/v2/statuses/';
                    break;
            }
            return $this;
        }

        /**
         * @brief 获取用户关注者列表。
         *
         * @param string $requestType GET
         * @param array $params
         *
         * @return object
         */
        public function followers($requestType, $params)
        {
            $this->type = $requestType;
            $this->uri = '/shuo/v2/users/'.$params['id'].'/followers';
            return $this;
        }
    }
        </code></pre>



        
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Simple-douban-oauth2 maintained by <a href="https://github.com/zither">zither</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    
  <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
